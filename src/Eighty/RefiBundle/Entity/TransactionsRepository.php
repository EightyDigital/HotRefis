<?php

namespace Eighty\RefiBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * TransactionsRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class TransactionsRepository extends EntityRepository
{
	public function filterProspects($postdata)
	{
		$offset = (($postdata['offset'] == 'random') ? rand(0,677420) : 0);
		
		return $this->getEntityManager()
			->createQuery(
				'SELECT t
					FROM RefiBundle:Transactions t
				'
			)
			->setMaxResults($postdata['limit'])
        	->setFirstResult($offset)
			->getArrayResult();
	}

	public function fetchProspectByTransactionsId($id)
	{
		return $this->getEntityManager()
			->createQuery(
				'SELECT p
					FROM RefiBundle:Prospect p
					LEFT JOIN RefiBundle:Prospectproperty pp
					WITH p.id = pp.prospectId  
					WHERE pp.salesId = :ppSalesId
				'
			)
			->setParameter('ppSalesId', $id)
			->getArrayResult();
	}
	
	public function fetchLoanByTransactionsId($id)
	{
		return $this->getEntityManager()
			->createQuery(
				'SELECT pl
					FROM RefiBundle:Prospectloan pl
					LEFT JOIN RefiBundle:Transactions t
					WITH t.id = pl.transactionId  
					WHERE t.id = :tId
				'
			)
			->setParameter('tId', $id)
			->getArrayResult();
	}
}